
# Gemini 開発ガイドライン for ContentFlow

---
## Part 1: 普遍的な開発原則 (全プロジェクト共通)
---

### 1.1. 基本的な開発ワークフロー

我々のプロジェクトでは、以下の反復的な開発プロセスを遵守する。

1.  **PRDの確認**: 人間が提示するPRD（プロダクト要求仕様書）を理解する。
2.  **設計書の作成**: Part 1.2 に記載の手順に従い、技術的実現可能性の検証（PoC）を経て、詳細な設計書を作成し、人間の承認を得る。
3.  **実装**: 承認された設計書に基づき、実装を行う。
4.  **テストと報告**: 実装結果をテストし、完了報告書を作成する。
5.  **設計書の更新**: 実装で得られた知見を設計書にフィードバックする。「生きたドキュメント」として常に最新の状態を保つこと。

### 1.2. PRD具体化マニュアル：要求から設計へのブリッジングガイド

PRDを読み込んだら、すぐに実装や最終的な設計書の作成に取り掛かってはいけない。まず、以下のステップに従って、人間と対話し、要求を具体化すること。

*   **ステップ1：PRDの要約と質疑応答**
    *   PRDを要約（目標、主要機能、課題）し、提示して認識を合わせる。

*   **ステップ2：技術的実現可能性の検証（PoC）**
    *   最も不確実性の高い要素を特定し、最小限のコードで実現可能か検証することを提案する。

*   **ステップ3：設計書の骨子（ドラフト）提案**
    *   最終的な設計書の「目次」を先に提案し、構成の合意を得る。

*   **ステップ4：詳細設計書の作成**
    *   合意した骨子に基づき、詳細な設計書を完成させる。機能だけでなく、堅牢性、保守性、テスト容易性、運用性といった品質要件も必ず含めること。

*   **ステップ5：最終確認と実装への移行**
    *   完成した設計書を提示し、「この設計内容で実装に進んでよろしいでしょうか？」と、人間に最終的な承認を求める。

### 1.3. セッション終了時の知見の棚卸し

セッションの最後に、人間から「ノウハウをまとめて」という指示があった場合、その日のやり取りで得られた新しい知見や、このGEMINI.mdに追記すべきルールを抽出し、Markdown形式で提案すること。

---
## Part 2: ContentFlow プロジェクト固有のルール
---

### 2.1. コアアーキテクチャの原則

- **AI中心主義**: コンテンツ（記事、画像プロンプト等）の動的生成は、常にAI（Gemini/ClaudeCode）自身が担う。プログラムに静的なコンテンツを持たせてはならない。
- **スクリプトによる自動化**: AIが生成した成果物を元に、ファイル連携や外部サービスへの投稿といった定型的な後続処理は、Node.jsやPythonのスクリプトが担当する。
- **ファイルベース連携**: AIとスクリプト間の連携は、`articles/article-{timestamp}.json` のような明確な仕様を持つファイルを介して行う。

### 2.2. 主要な技術スタックとコマンド

- **ワークフロー起点**: `sanity-edition/scripts/start-full-workflow.js`
- **Sanity投稿モジュール**: `sanity-edition/scripts/upload-article.js`
- **品質チェッカー**: `sanity-edition/scripts/quality-checker.js`
- **E2Eテスト**: `sanity-edition/scripts/e2e-test.js`
- **環境変数ファイル**: `sanity-edition/.env.local` を `dotenv` パッケージで読み込むこと。

### 2.3. ペルソナ・構成ファイル

- **ペルソナ**: `sanity-edition/HIRO_PERSONA.md`
- **記事構成**: `sanity-edition/HIRO_ARTICLE_STRUCTURE.md`

### 2.4. 開発上の注意点

- **設計書の更新**: 実装中に設計からの変更が必要になった場合は、まず設計書を更新し、合意を得てからコードを修正すること。
- **ファイル選択ロジック**: `start-full-workflow.js` は、`metadata.createdAt` を基準に最新の `article-*.json` ファイルを選択する。古い形式のファイルは無視される。
